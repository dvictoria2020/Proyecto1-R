---
title: "Proyecto 1 R"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Carga de paquetes y de datos

```{r paquetes, warning=FALSE, message=FALSE}
# Paquete para manipulación de datos
library(dplyr)
# Paquete para manejo de datos vectoriales
library(sf)
# Paquetes para manejo de datos raster
library(terra)
# Paquete para manejo de tablas
library(DT)
# Paquetes para graficación
library(ggplot2)
library(plotly)
# Paquete para mapas interactivos
library(leaflet)
```


```{r datos, warning=FALSE, message=FALSE}
# Lectura de una capa vectorial (GeoJSON) de división distrial de Santa Ana
limite_distrital <-
  st_read(
    "https://dvictoria2020.github.io/Proyecto1-R/limite_distrital.geojson",
    quiet = TRUE
  )

# Transformación del CRS del objeto división distrital
limite_distrital <-
  limite_distrital %>%
  st_transform(4326)

# Lectura de archivo CSV de patentes comerciales en Santa Ana
Patente_final <-
  st_read(
    "/vsicurl/https://dvictoria2020.github.io/Proyecto1-R/Patente_final.csv",
    options = c(
      "X_POSSIBLE_NAMES=Latitud",
      "Y_POSSIBLE_NAMES=Longitu"
    ),
    quiet = TRUE
  )

# Asignación de un CRS al objeto patentes
st_crs(Patente_final) <- 4326


# Lectura de capa raster de uso urbano
uso_urbano_rWGS <-
  rast(
    "/vsicurl/https://dvictoria2020.github.io/Proyecto1-R/uso_urbano_rWGS.tif",
  )
```


# Tabla

```{r tabla}
  Patente_final %>%
  st_drop_geometry() %>%
  select(N_patente, Aprobacion, Actividad, Permiso_sa, Rotulo, N_finca, Tipo_perso, Direccion_, Distrito) %>%
  datatable(Patente_final, options = list(
    language = list(url = '//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json'),
    pageLenth =5
  ))
```


### Mapa de distribución


```{r mapa, warning=FALSE}
# Conversión del objeto uso a la clase RasterLayer
uso_urbano_rWGS_rl <- raster::raster(uso_urbano_rWGS)

# Mapa leaflet
leaflet() %>%
  addProviderTiles("Esri.WorldImagery", group="Imagen Satelital") %>%
  addTiles(options = providerTileOptions(noWrap = TRUE), group="Open Street Maps") %>%
  addRasterImage(
    uso_urbano_rWGS_rl, 
    opacity = 0.8
  )%>% 
  addPolygons(
    data = limite_distrital,
    color = "purple",
    fillColor = "transparent",
    stroke = TRUE,
    weight = 2.0,
  )%>% 
  addCircleMarkers(
    data = Patente_final,
    stroke = F,
    radius = 4,
    fillColor = 'orange',
    fillOpacity = 1,
    clusterOptions = markerClusterOptions(),
    label = "Actividad",
    labelOptions = labelOptions(noHide = T, textsize = "15px")
  )%>% 
 addWMSTiles(
    "https://sig.mivah.go.cr/server/services/cit/AsentamientosInformales/MapServer/WMSServer?request=GetCapabilities&service=WMS",
    layers = "Asentameintos",
    options = WMSTileOptions(format = "image/png", transparent = TRUE),
    attribution = "Weather data © 2012 IEM Nexrad"
  )%>%
 addLayersControl(
   overlayGroups = c("uso_urbano_rWGS_rl","limite_distrital") ,
   baseGroups = c("Imagen Satelital","Open Street Maps"), 
   options = layersControlOptions(collapsed = FALSE)
  )
	    
```
